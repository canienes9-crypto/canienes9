-- [[ CYRUS HUB - FINAL V3 (FIXED & FULL) ]] --
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

-- Temizlik
if CoreGui:FindFirstChild("CyrusFinal") then CoreGui.CyrusFinal:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CyrusFinal"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false

-- Global Kontroller
local Config = {
    Aimbot = false,
    AimPart = "Head",
    Smoothness = 0.8, -- 0.1 sert, 0.9 Ã§ok yumuÅŸak
    FOV = 120,
    InfiniteJump = false,
    Noclip = false,
    AutoFarm = false,
    AutoShake = false,
    PoliceESP = false
}

----------------------------------------------------------------
-- ðŸŽ¯ GELÄ°ÅžMÄ°Åž VE DÃœZELTÄ°LMÄ°Åž AIMBOT (SaÄŸ TÄ±k KontrollÃ¼)
----------------------------------------------------------------
local function GetClosestPlayer()
    local ClosestPlayer = nil
    local ShortestDistance = 1000
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(Config.AimPart) then
            -- TakÄ±m KontrolÃ¼
            if player.Team == LocalPlayer.Team then continue end
            
            local targetPart = player.Character[Config.AimPart]
            local screenPoint, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
            
            if onScreen then
                local fovDistance = (Vector2.new(screenPoint.X, screenPoint.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
                if fovDistance <= Config.FOV then
                    ClosestPlayer = player
                    ShortestDistance = fovDistance
                end
            end
        end
    end
    return ClosestPlayer
end

-- Aimbot Sadece SaÄŸ TÄ±kla Ã‡alÄ±ÅŸÄ±r (Ekran kilitlenmesini Ã¶nler)
RunService.RenderStepped:Connect(function()
    if Config.Aimbot and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        local target = GetClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild(Config.AimPart) then
            local lookCFrame = CFrame.lookAt(Camera.CFrame.Position, target.Character[Config.AimPart].Position)
            Camera.CFrame = Camera.CFrame:Lerp(lookCFrame, 1 - Config.Smoothness)
        end
    end
end)

----------------------------------------------------------------
-- ðŸ¢ UI SÄ°STEMÄ°
----------------------------------------------------------------
local function makeDraggable(gui)
    local dragging, dragInput, dragStart, startPos
    gui.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType.Touch then
            dragging = true; dragStart = input.Position; startPos = gui.Position
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            gui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    gui.InputEnded:Connect(function(input) dragging = false end)
end

local function BuildUI()
    local MainFrame = Instance.new("Frame", ScreenGui)
    MainFrame.Size = UDim2.new(0, 480, 0, 400)
    MainFrame.Position = UDim2.new(0.5, -240, 0.5, -200)
    MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
    Instance.new("UICorner", MainFrame)
    makeDraggable(MainFrame)

    local Title = Instance.new("TextLabel", MainFrame)
    Title.Text = "CYRUS HUB - ULTIMATE FIX"; Title.Size = UDim2.new(1, 0, 0, 40)
    Title.TextColor3 = Color3.new(1,1,1); Title.BackgroundTransparency = 1

    local List = Instance.new("ScrollingFrame", MainFrame)
    List.Size = UDim2.new(0.9, 0, 0.8, 0); List.Position = UDim2.new(0.05, 0, 0.15, 0)
    List.BackgroundTransparency = 1; List.ScrollBarThickness = 3
    Instance.new("UIListLayout", List).Padding = UDim.new(0, 5)

    local function AddToggle(name, callback)
        local b = Instance.new("TextButton", List)
        b.Size = UDim2.new(1, -10, 0, 40); b.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        b.Text = name .. " : OFF"; b.TextColor3 = Color3.new(1,1,1)
        Instance.new("UICorner", b)
        local state = false
        b.MouseButton1Click:Connect(function()
            state = not state; callback(state)
            b.Text = name .. (state and " : ON" or " : OFF")
            b.BackgroundColor3 = state and Color3.fromRGB(0, 150, 100) or Color3.fromRGB(40, 40, 50)
        end)
    end

    -- Ã–ZELLÄ°KLER
    AddToggle("Genel: Aimbot (SaÄŸ TÄ±k Tut)", function(v) Config.Aimbot = v end)
    
    AddToggle("Jailbreak: Lazerleri Sil", function(v)
        if v then for _, obj in pairs(Workspace:GetDescendants()) do if obj.Name:lower():find("laser") then obj:Destroy() end end end
    end)
    
    AddToggle("Jailbreak: NPC Temizle", function(v)
        if v then for _, obj in pairs(Workspace:GetDescendants()) do if obj.Name:lower():find("npc") then obj:Destroy() end end end
    end)

    AddToggle("Jailbreak: Polis ESP", function(v)
        Config.PoliceESP = v
        task.spawn(function()
            while Config.PoliceESP do
                for _, p in pairs(Players:GetPlayers()) do
                    if p.Team and p.Team.Name == "Police" and p.Character then
                        if not p.Character:FindFirstChild("Highlight") then
                            local h = Instance.new("Highlight", p.Character)
                            h.FillColor = Color3.new(0, 0, 1)
                        end
                    end
                end
                task.wait(2)
            end
        end)
    end)

    AddToggle("Military: Auto Farm (Collect)", function(v)
        Config.AutoFarm = v
        task.spawn(function()
            while Config.AutoFarm do
                pcall(function()
                    for _, Tycoon in pairs(Workspace.PlayerTycoons:GetChildren()) do
                        if Tycoon.Name == LocalPlayer.Name then
                            local collect = Tycoon:FindFirstChild("Models") and Tycoon.Models:FindFirstChild("StarterGiver") and Tycoon.Models.StarterGiver:FindFirstChild("CollectButton")
                            if collect then
                                firetouchinterest(LocalPlayer.Character.HumanoidRootPart, collect, 0)
                                firetouchinterest(LocalPlayer.Character.HumanoidRootPart, collect, 1)
                            end
                        end
                    end
                end)
                task.wait(1)
            end
        end)
    end)

    AddToggle("Military: Elmas & Shake Para", function(v)
        Config.AutoShake = v
        task.spawn(function()
            while Config.AutoShake do
                ReplicatedStorage.Events.BuyGuyBundle:FireServer()
                task.wait(0.5)
            end
        end)
    end)

    AddToggle("Genel: Noclip", function(v) Config.Noclip = v end)
    AddToggle("Genel: Sonsuz ZÄ±plama", function(v) Config.InfiniteJump = v end)
end

-- Arka Plan DÃ¶ngÃ¼leri
RunService.Stepped:Connect(function()
    if Config.Noclip and LocalPlayer.Character then
        for _, p in pairs(LocalPlayer.Character:GetDescendants()) do 
            if p:IsA("BasePart") then p.CanCollide = false end 
        end
    end
end)

UserInputService.JumpRequest:Connect(function()
    if Config.InfiniteJump and LocalPlayer.Character then
        local h = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if h then h:ChangeState("Jumping") end
    end
end)

BuildUI()
