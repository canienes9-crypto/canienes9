-- [[ CYRUS HUB - FINAL ULTIMATE PRO (UPDATED) ]] --
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

-- Temizlik
if CoreGui:FindFirstChild("CyrusFinal") then CoreGui.CyrusFinal:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CyrusFinal"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false

-- Global Kontroller & Config
local Config = {
    InfiniteJump = false,
    Noclip = false,
    AutoFarm = false,
    AutoShake = false,
    PoliceESP = false,
    -- Aimbot Config
    AimbotEnabled = false,
    AimPart = "Head",
    MaxDistance = 500,
    FOV = 90,
    Smoothness = 0.5,
    TeamCheck = true
}

----------------------------------------------------------------
-- ðŸŽ¯ AIMBOT YARDIMCI FONKSÄ°YONLAR
----------------------------------------------------------------
local function GetClosestPlayer()
    local ClosestPlayer = nil
    local ShortestDistance = Config.MaxDistance
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(Config.AimPart) then
            if Config.TeamCheck and player.Team == LocalPlayer.Team then continue end
            
            local targetPart = player.Character[Config.AimPart]
            local screenPoint, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
            
            if onScreen then
                local distance = (LocalPlayer.Character.HumanoidRootPart.Position - targetPart.Position).Magnitude
                local fovDistance = (Vector2.new(screenPoint.X, screenPoint.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
                
                if distance < ShortestDistance and fovDistance <= Config.FOV * 2 then
                    ClosestPlayer = player
                    ShortestDistance = distance
                end
            end
        end
    end
    return ClosestPlayer
end

-- Aimbot DÃ¶ngÃ¼sÃ¼
RunService.RenderStepped:Connect(function()
    if Config.AimbotEnabled then
        local target = GetClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild(Config.AimPart) then
            local targetPos = target.Character[Config.AimPart].Position
            local lookCFrame = CFrame.lookAt(Camera.CFrame.Position, targetPos)
            Camera.CFrame = Camera.CFrame:Lerp(lookCFrame, 1 - Config.Smoothness)
        end
    end
end)

----------------------------------------------------------------
-- ðŸ“± SÃœRÃœKLENEBÄ°LÄ°R SÄ°STEM
----------------------------------------------------------------
local function makeDraggable(gui)
    local dragging, dragInput, dragStart, startPos
    gui.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true; dragStart = input.Position; startPos = gui.Position
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            gui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    gui.InputEnded:Connect(function(input) dragging = false end)
end

----------------------------------------------------------------
-- ðŸ¢ ANA PANEL
----------------------------------------------------------------
local function BuildFinalUI()
    local MainFrame = Instance.new("Frame", ScreenGui)
    MainFrame.Size = UDim2.new(0, 480, 0, 380)
    MainFrame.Position = UDim2.new(0.5, -240, 0.5, -190)
    MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 22)
    Instance.new("UICorner", MainFrame)
    makeDraggable(MainFrame)

    local Stroke = Instance.new("UIStroke", MainFrame)
    Stroke.Thickness = 3
    task.spawn(function() while task.wait() do Stroke.Color = Color3.fromHSV(tick()%5/5, 0.8, 1) end end)

    local Mini = Instance.new("TextButton", ScreenGui)
    Mini.Size = UDim2.new(0, 55, 0, 55); Mini.Position = UDim2.new(0, 10, 0.5, 0); Mini.Visible = false
    Mini.Text = "CYRUS"; Mini.BackgroundColor3 = Color3.fromRGB(20, 20, 30); Mini.TextColor3 = Color3.new(0, 1, 0.5)
    Instance.new("UICorner", Mini).CornerRadius = UDim.new(1, 0)
    makeDraggable(Mini)

    local Search = Instance.new("TextBox", MainFrame)
    Search.Size = UDim2.new(0.9, 0, 0, 40); Search.Position = UDim2.new(0.05, 0, 0.05, 0)
    Search.PlaceholderText = "Ã–zellik Ara (Arsenal, Jailbreak, Genel)..."
    Search.BackgroundColor3 = Color3.fromRGB(25, 25, 35); Search.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", Search)

    local List = Instance.new("ScrollingFrame", MainFrame)
    List.Size = UDim2.new(0.9, 0, 0.75, 0); List.Position = UDim2.new(0.05, 0, 0.2, 0)
    List.BackgroundTransparency = 1; List.ScrollBarThickness = 2
    local Layout = Instance.new("UIListLayout", List); Layout.Padding = UDim.new(0, 8)

    local function AddToggle(name, tags, callback)
        local b = Instance.new("TextButton", List)
        b.Size = UDim2.new(1, -10, 0, 45); b.Text = name .. " : OFF"
        b.BackgroundColor3 = Color3.fromRGB(35, 35, 45); b.TextColor3 = Color3.new(1,1,1)
        Instance.new("UICorner", b)
        local act = false
        b.MouseButton1Click:Connect(function()
            act = not act; callback(act)
            b.Text = name .. (act and " : ON" or " : OFF")
            b.BackgroundColor3 = act and Color3.fromRGB(0, 120, 255) or Color3.fromRGB(35, 35, 45)
        end)
        Search:GetPropertyChangedSignal("Text"):Connect(function()
            b.Visible = (Search.Text == "" or string.find(tags:lower(), Search.Text:lower()))
        end)
    end

    -- --- [ ARSENAL Ã–ZELLÄ°KLERÄ° ] ---
    AddToggle("Arsenal: Aimbot", "arsenal aimbot silah", function(v)
        Config.AimbotEnabled = v
    end)

    -- --- [ JAILBREAK Ã–ZELLÄ°KLERÄ° ] ---
    AddToggle("Jailbreak: Lazerleri Sil", "jailbreak lazer", function(v)
        if v then for _, obj in pairs(Workspace:GetDescendants()) do if obj.Name:lower():find("laser") then obj:Destroy() end end end
    end)

    -- --- [ GENEL Ã–ZELLÄ°KLER ] ---
    AddToggle("Genel: Noclip", "genel duvar", function(v) Config.Noclip = v end)
    AddToggle("Genel: Sonsuz ZÄ±plama", "genel jump", function(v) Config.InfiniteJump = v end)

    -- Kapatma / AÃ§ma ButonlarÄ±
    local Close = Instance.new("TextButton", MainFrame)
    Close.Text = "X"; Close.Size = UDim2.new(0, 35, 0, 35); Close.Position = UDim2.new(1, -40, 0, 5)
    Close.BackgroundColor3 = Color3.new(0.7, 0, 0); Instance.new("UICorner", Close)
    
    Close.MouseButton1Click:Connect(function() MainFrame.Visible = false; Mini.Visible = true end)
    Mini.MouseButton1Click:Connect(function() MainFrame.Visible = true; Mini.Visible = false end)
end

-- Arka Plan Servisleri (Noclip & Jump)
RunService.Stepped:Connect(function()
    if Config.Noclip and LocalPlayer.Character then
        for _, p in pairs(LocalPlayer.Character:GetDescendants()) do if p:IsA("BasePart") then p.CanCollide = false end end
    end
end)
UserInputService.JumpRequest:Connect(function()
    if Config.InfiniteJump and LocalPlayer.Character then
        local h = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if h then h:ChangeState("Jumping") end
    end
end)

-- BAÅžLAT
BuildFinalUI()
